(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a99b31d4"],{9380:function(t,s,e){},cf2a:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"order",style:{backgroundColor:0===t.orderList.length?"#fff":""}},[e("van-nav-bar",{attrs:{title:"订单管理","left-text":"返回","left-arrow":""},on:{"click-left":t.onClickLeft}}),e("div",{staticClass:"tab-list"},[e("van-tabs",{on:{change:t.toggleTab},model:{value:t.currentTab,callback:function(s){t.currentTab=s},expression:"currentTab"}},t._l(t.tabList,(function(s){return e("van-tab",{key:s.status,attrs:{title:s.title}},[e("div",{staticClass:"order-box"},[e("ul",t._l(t.orderList,(function(s){return e("li",{key:s.oid,staticClass:"order-item"},[e("div",{staticClass:"order-item-head"},[e("span",{staticClass:"type"},[t._v(t._s(s.type))]),e("span",{staticClass:"address"},[t._v(t._s(s.oid))]),2===s.status?e("span",{staticClass:"status"},[t._v("已取餐")]):e("span",{staticClass:"code"},[t._v("取餐码："+t._s(s.products[0].id))])]),e("div",{staticClass:"order-item-detail"},t._l(s.products,(function(s){return e("div",{key:s.id,staticClass:"item-detail-box"},[e("div",{staticClass:"pay-img"},[e("img",{staticClass:"img-layout",attrs:{src:s.smallImg,alt:""}})]),e("div",{staticClass:"pay-info"},[e("h3",{staticClass:"name"},[t._v(t._s(s.name)),e("span",{staticClass:"pay-count"},[t._v("x"+t._s(s.count))])]),e("p",{staticClass:"type"},[t._v(t._s(s.rule.split("/").join(" / ")))])]),e("div",{staticClass:"pay-price"},[t._v(" ￥"+t._s(s.price)+" ")])])})),0),e("div",{staticClass:"order-item-total"},[e("span",[t._v("合计￥"+t._s(s.total))])]),e("div",{staticClass:"order-item-footer"},[e("div",{staticClass:"date"},[t._v(t._s(t._f("formatDate")(s.date,"YYYY-MM-DD hh:mm:ss")))]),"外送"===s.type?e("button",{staticClass:"detail-btn",on:{click:function(e){return t.showInfo(s)}}},[t._v("详情")]):t._e(),1===s.status?e("button",{staticClass:"confirm-btn",on:{click:function(e){return t.confirm(s.oid,"/receive")}}},[t._v("确认收货")]):t._e(),2===s.status?e("button",{staticClass:"remove-btn",on:{click:function(e){return t.confirm(s.oid,"/removeOrder")}}},[t._v("删除")]):t._e()])])})),0)]),0===t.orderList.length?e("div",{staticClass:"empty-box"},[e("van-empty",{staticClass:"custom-image",attrs:{image:"https://img.yzcdn.cn/vant/custom-empty-image.png",description:"订单空空如也，去喝一杯吧~"}},[e("button",{staticClass:"btn",on:{click:t.showMenuHandle}},[t._v("去喝一杯 ~")])])],1):t._e()])})),1)],1),e("van-popup",{style:{height:"30%"},attrs:{position:"bottom"},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("div",{staticClass:"user"},[e("p",[t._v("订单号："+t._s(t.currentOrderInfo.oid))]),e("p",[t._v("收件人："+t._s(t.currentOrderInfo.receiver))]),e("p",[t._v("手机号码："+t._s(t.currentOrderInfo.phone))]),e("p",{staticClass:"address"},[t._v("收货地址："+t._s(t.currentOrderInfo.address))])])])],1)},i=[],o=(e("4160"),e("ac1f"),e("1276"),e("159b"),e("5530")),r=(e("9380"),e("2f62")),n=e("2f14"),c={data:function(){return{currentTab:0,orderList:[],tabList:[{title:"全部订单",status:0},{title:"待收货",status:1},{title:"已收货",status:2}],show:!1,currentOrderInfo:{}}},created:function(){this.getOrderData(this.currentTab)},methods:{showInfo:function(t){this.currentOrderInfo={},this.show=!0,console.log(t.products[0].receiver.split("-")[0]);var s={oid:t.oid,receiver:t.products[0].receiver.split("-")[0],phone:t.products[0].phone,address:t.products[0].address};this.currentOrderInfo=s},showMenuHandle:function(){this.$router.push({name:"Menu"})},confirm:function(t,s){var e=this;if(this.getToken){var a=n["a"].queryString({appkey:this.appkey,tokenString:this.getToken,oid:t});this.$toast({type:"loading",message:"加载中",forbidClick:!0,loadingType:"spinner",duration:0}),this.axios({method:"POST",url:s,data:a}).then((function(t){e.$toast.clear(),e.$toast(t.data.msg),console.log(t),8e4!==t.data.code&&9e4!==t.data.code||e.getOrderData(e.currentTab)})).catch((function(t){e.$toast.clear(),console.log(t)}))}else this.$router.push({name:"Login"})},toggleTab:function(t){this.getOrderData(t)},getOrderData:function(t){var s=this;if(this.getToken){var e={appkey:this.appkey,tokenString:this.getToken,status:t};this.$toast({type:"loading",message:"加载中",forbidClick:!0,loadingType:"spinner",duration:0}),this.axios({method:"GET",url:"/findOrder",params:e}).then((function(t){if(s.orderList=[],s.$toast.clear(),console.log(t),7e4===t.data.code){var e={};for(var a in t.data.result.forEach((function(t){e[t.oid]?(e[t.oid].total+=t.count*t.price,e[t.oid].products.push(t)):e[t.oid]={oid:t.oid,date:t.createdAt,total:t.count*t.price,products:[t],status:t.status,type:t.receiver.split("-")[1]}})),e)s.orderList.push(e[a]);s.orderList.sort((function(t,s){return new Date(s.date).getTime()-new Date(t.date).getTime()})),console.log(s.orderList)}})).catch((function(t){s.$toast.clear(),console.log(t)}))}else this.$router.push({name:"Login"})},onClickLeft:function(){this.$router.go(-1)}},computed:Object(o["a"])({},Object(r["b"])(["getToken"]))},d=c,l=e("2877"),u=Object(l["a"])(d,a,i,!1,null,null,null);s["default"]=u.exports}}]);
//# sourceMappingURL=chunk-a99b31d4.b6424cd7.js.map